/* ============================================
   TRANSLATIONS - Bilingual System (ES/EN)
   ============================================ */

const TRANSLATIONS = {
    es: {
        // Navigation
        backToHome: 'â† Volver al Inicio',

        // Hero
        heroTitle: {
            home: 'Â¡Feliz AÃ±o Nuevo 2025!',
            colombia: 'ğŸ‡¨ğŸ‡´ AÃ±o Nuevo Colombiano',
            usa: 'ğŸ‡ºğŸ‡¸ AÃ±o Nuevo Americano',
            mexico: 'ğŸ‡²ğŸ‡½ AÃ±o Nuevo Mexicano'
        },
        heroSubtitle: 'Crea y envÃ­a tarjetas personalizadas',
        orionPoweredBy: 'ğŸ¤– Desarrollado por ORION',

        // Form
        createCardTitle: 'ğŸ† Crea tu Tarjeta de AÃ±o Nuevo con IA',
        aiEngine: 'ğŸ¤– Motor de IA',
        recipientName: 'ğŸ‘¤ Nombre del destinatario',
        recipientPlaceholder: 'Ej: MarÃ­a, Juan Carlos, MamÃ¡...',
        senderLabel: 'âœï¸ Tu nombre (remitente)',
        senderPlaceholder: 'Ej: Tu familia, Alex, Con cariÃ±o...',
        messageType: 'ğŸ­ Tipo de mensaje',
        forWhom: 'ğŸ‘« Â¿Para quiÃ©n es?',
        additionalContext: 'ğŸ’­ Contexto adicional (opcional)',
        contextPlaceholder: 'Ej: Es mi abuela de 80 aÃ±os que vive en MedellÃ­n...',
        contextHint: 'La IA usarÃ¡ esto para hacer el mensaje mÃ¡s personal',

        // Message types
        messageTypes: {
            familiar: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Familiar - CÃ¡lido y emotivo',
            comico: 'ğŸ˜‚ CÃ³mico - Divertido y alegre',
            amoroso: 'â¤ï¸ Amoroso - RomÃ¡ntico y especial',
            motivacional: 'ğŸ’ª Motivacional - Inspirador y fuerte',
            espiritual: 'ğŸ™ Espiritual - Fe y bendiciones'
        },

        // Gender options
        genderOptions: {
            general: 'ğŸ„ General - Para cualquier persona',
            mujer: 'ğŸ‘© Para ella',
            hombre: 'ğŸ‘¨ Para Ã©l'
        },

        // AI options
        generateAIMessage: 'âœ¨ Generar mensaje Ãºnico con IA',
        generateAIImage: 'ğŸ¨ Generar imagen de AÃ±o Nuevo con IA (DALL-E)',
        attachFile: 'ğŸ“ Adjuntar archivo (opcional)',
        attachHint: 'Imagen o video para incluir en la tarjeta',

        // Image gallery
        selectBackground: 'ğŸ–¼ï¸ Imagen de fondo',

        // TTS
        voiceLabel: 'ğŸ¤ Voz para leer el mensaje',
        voiceOptions: {
            alegre: 'ğŸ‰ Alegre y Festiva',
            solemne: 'ğŸ•¯ï¸ Solemne y Espiritual',
            comico: 'ğŸ˜‚ CÃ³mica y Divertida',
            romantico: 'â¤ï¸ RomÃ¡ntica y Suave',
            motivacional: 'ğŸ’ª Motivacional y EnergÃ©tica'
        },
        testVoice: 'ğŸ”Š Probar Voz',

        // Buttons
        createCard: 'ğŸ Crear Tarjeta con IA',
        shareWhatsApp: 'ğŸ“± WhatsApp',
        shareTelegram: 'âœˆï¸ Telegram',
        shareEmail: 'ğŸ“§ Email',
        copyLink: 'ğŸ“‹ Copiar Link',

        // Card viewer
        openEnvelope: 'âœ‰ï¸ Haz clic para abrir',
        loadingCard: 'Cargando tu tarjeta...',
        preparingSomething: 'Preparando algo especial para ti âœ¨',
        cardNotFound: 'ğŸ˜¢ Tarjeta no encontrada',
        linkExpired: 'El enlace puede haber expirado o ser incorrecto.',
        createOwn: 'Crear mi propia tarjeta',
        withLoveFrom: 'Con cariÃ±o',

        // Toasts
        imageSelected: 'ğŸ–¼ï¸ Imagen seleccionada',
        musicPlaying: 'ğŸµ MÃºsica de AÃ±o Nuevo activa',
        musicPaused: 'ğŸ”‡ MÃºsica pausada',
        linkCopied: 'Â¡Link copiado! ğŸ“‹',
        blessingsMsg: 'que este AÃ±o Nuevo llene tu vida de bendiciones',
        dear: 'Querido/a',
        friend: 'Amigo/a',
        personalize: 'ğŸ Personalizar',

        // Footer
        madeWithLove: 'Hecho con â¤ï¸ y espÃ­ritu festivo ğŸ†',

        // Language switch
        switchTo: 'English'
    },

    en: {
        // Navigation
        backToHome: 'â† Back to Home',

        // Hero
        heroTitle: {
            home: 'Happy New Year 2025!',
            colombia: 'ğŸ‡¨ğŸ‡´ Colombian New Year',
            usa: 'ğŸ‡ºğŸ‡¸ American New Year',
            mexico: 'ğŸ‡²ğŸ‡½ Mexican New Year'
        },
        heroSubtitle: 'Create and send personalized cards',
        orionPoweredBy: 'ğŸ¤– Powered by ORION',

        // Form
        createCardTitle: 'ğŸ† Create Your AI New Year Card',
        aiEngine: 'ğŸ¤– AI Engine',
        recipientName: 'ğŸ‘¤ Recipient\'s name',
        recipientPlaceholder: 'E.g: Mary, John, Mom...',
        senderLabel: 'âœï¸ Your name (sender)',
        senderPlaceholder: 'E.g: Your family, Alex, With love...',
        messageType: 'ğŸ­ Message style',
        forWhom: 'ğŸ‘« Who is this for?',
        additionalContext: 'ğŸ’­ Additional context (optional)',
        contextPlaceholder: 'E.g: She is my 80-year-old grandma who loves baking...',
        contextHint: 'AI will use this to personalize the message',

        // Message types
        messageTypes: {
            familiar: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family - Warm & heartfelt',
            comico: 'ğŸ˜‚ Funny - Light & humorous',
            amoroso: 'â¤ï¸ Romantic - Sweet & loving',
            motivacional: 'ğŸ’ª Motivational - Inspiring',
            espiritual: 'ğŸ™ Spiritual - Faith & blessings'
        },

        // Gender options
        genderOptions: {
            general: 'ğŸ„ Anyone',
            mujer: 'ğŸ‘© For Her',
            hombre: 'ğŸ‘¨ For Him'
        },

        // AI options
        generateAIMessage: 'âœ¨ Generate unique AI message',
        generateAIImage: 'ğŸ¨ Generate AI New Year image (DALL-E)',
        attachFile: 'ğŸ“ Attach file (optional)',
        attachHint: 'Image or video to include in the card',

        // Image gallery
        selectBackground: 'ğŸ–¼ï¸ Background image',

        // TTS
        voiceLabel: 'ğŸ¤ Voice to read message',
        voiceOptions: {
            alegre: 'ğŸ‰ Cheerful & Festive',
            solemne: 'ğŸ•¯ï¸ Solemn & Spiritual',
            comico: 'ğŸ˜‚ Comic & Fun',
            romantico: 'â¤ï¸ Romantic & Soft',
            motivacional: 'ğŸ’ª Motivational & Energetic'
        },
        testVoice: 'ğŸ”Š Test Voice',

        // Buttons
        createCard: 'ğŸ Create AI Card',
        shareWhatsApp: 'ğŸ“± WhatsApp',
        shareTelegram: 'âœˆï¸ Telegram',
        shareEmail: 'ğŸ“§ Email',
        copyLink: 'ğŸ“‹ Copy Link',

        // Card viewer
        openEnvelope: 'âœ‰ï¸ Click to open',
        loadingCard: 'Loading your card...',
        preparingSomething: 'Preparing something special for you âœ¨',
        cardNotFound: 'ğŸ˜¢ Card not found',
        linkExpired: 'The link may have expired or is incorrect.',
        createOwn: 'Create my own card',
        withLoveFrom: 'With love',

        // Toasts
        imageSelected: 'ğŸ–¼ï¸ Image selected',
        musicPlaying: 'ğŸµ New Year music playing',
        musicPaused: 'ğŸ”‡ Music paused',
        linkCopied: 'Link copied! ğŸ“‹',
        blessingsMsg: 'may this New Year fill your life with blessings',
        dear: 'Dear',
        friend: 'Friend',
        personalize: 'ğŸ Personalize',

        // Footer
        madeWithLove: 'Made with â¤ï¸ and festive spirit ğŸ†',

        // Language switch
        switchTo: 'EspaÃ±ol'
    },

    pt: {
        // Navigation
        backToHome: 'â† Voltar ao InÃ­cio',

        // Hero
        heroTitle: {
            home: 'Feliz Ano Novo 2025!',
            colombia: 'ğŸ‡¨ğŸ‡´ Ano Novo Colombiano',
            usa: 'ğŸ‡ºğŸ‡¸ Ano Novo Americano',
            mexico: 'ğŸ‡²ğŸ‡½ Ano Novo Mexicano'
        },
        heroSubtitle: 'Crie e envie cartÃµes personalizados',
        orionPoweredBy: 'ğŸ¤– Desenvolvido por ORION',

        // Form
        createCardTitle: 'ğŸ† Crie seu CartÃ£o de Ano Novo com IA',
        aiEngine: 'ğŸ¤– Motor de IA',
        recipientName: 'ğŸ‘¤ Nome do destinatÃ¡rio',
        recipientPlaceholder: 'Ex: Maria, JoÃ£o Carlos, MÃ£e...',
        senderLabel: 'âœï¸ Seu nome (remetente)',
        senderPlaceholder: 'Ex: Sua famÃ­lia, Alex, Com carinho...',
        messageType: 'ğŸ­ Tipo de mensagem',
        forWhom: 'ğŸ‘« Para quem Ã©?',
        additionalContext: 'ğŸ’­ Contexto adicional (opcional)',
        contextPlaceholder: 'Ex: Ã‰ minha avÃ³ de 80 anos que mora em MedellÃ­n...',
        contextHint: 'A IA usarÃ¡ isso para tornar a mensagem mais pessoal',

        // Message types
        messageTypes: {
            familiar: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Familiar - Caloroso e emotivo',
            comico: 'ğŸ˜‚ CÃ´mico - EngraÃ§ado e alegre',
            amoroso: 'â¤ï¸ Amoroso - RomÃ¢ntico e especial',
            motivacional: 'ğŸ’ª Motivacional - Inspirador e forte',
            espiritual: 'ğŸ™ Espiritual - FÃ© e bÃªnÃ§Ã£os'
        },

        // Gender options
        genderOptions: {
            general: 'ğŸ„ Geral - Para qualquer pessoa',
            mujer: 'ğŸ‘© Para ela',
            hombre: 'ğŸ‘¨ Para ele'
        },

        // AI options
        generateAIMessage: 'âœ¨ Gerar mensagem Ãºnica com IA',
        generateAIImage: 'ğŸ¨ Gerar imagem de Ano Novo com IA (DALL-E)',
        attachFile: 'ğŸ“ Anexar arquivo (opcional)',
        attachHint: 'Imagem ou vÃ­deo para incluir no cartÃ£o',

        // Image gallery
        selectBackground: 'ğŸ–¼ï¸ Imagem de fundo',

        // TTS
        voiceLabel: 'ğŸ¤ Voz para ler a mensagem',
        voiceOptions: {
            alegre: 'ğŸ‰ Alegre e Festiva',
            solemne: 'ğŸ•¯ï¸ Solene e Espiritual',
            comico: 'ğŸ˜‚ CÃ´mica e Divertida',
            romantico: 'â¤ï¸ RomÃ¢ntica e Suave',
            motivacional: 'ğŸ’ª Motivacional e EnergÃ©tica'
        },
        testVoice: 'ğŸ”Š Testar Voz',

        // Buttons
        createCard: 'ğŸ Criar CartÃ£o com IA',
        shareWhatsApp: 'ğŸ“± WhatsApp',
        shareTelegram: 'âœˆï¸ Telegram',
        shareEmail: 'ğŸ“§ Email',
        copyLink: 'ğŸ“‹ Copiar Link',

        // Card viewer
        openEnvelope: 'âœ‰ï¸ Clique para abrir',
        loadingCard: 'Carregando seu cartÃ£o...',
        preparingSomething: 'Preparando algo especial para vocÃª âœ¨',
        cardNotFound: 'ğŸ˜¢ CartÃ£o nÃ£o encontrado',
        linkExpired: 'O link pode ter expirado ou estar incorreto.',
        createOwn: 'Criar meu prÃ³prio cartÃ£o',
        withLoveFrom: 'Com carinho',

        // Toasts
        imageSelected: 'ğŸ–¼ï¸ Imagem selecionada',
        musicPlaying: 'ğŸµ MÃºsica de Ano Novo ativa',
        musicPaused: 'ğŸ”‡ MÃºsica pausada',
        linkCopied: 'Link copiado! ğŸ“‹',
        blessingsMsg: 'que este Ano Novo encha sua vida de bÃªnÃ§Ã£os',
        dear: 'Querido/a',
        friend: 'Amigo/a',
        personalize: 'ğŸ Personalizar',

        // Footer
        madeWithLove: 'Feito com â¤ï¸ e espÃ­rito festivo ğŸ†',

        // Language switch
        switchTo: 'PortuguÃªs'
    },

    fr: {
        // Navigation
        backToHome: 'â† Retour Ã  l\'accueil',

        // Hero
        heroTitle: {
            home: 'Bonne AnnÃ©e 2025!',
            colombia: 'ğŸ‡¨ğŸ‡´ Nouvel An Colombien',
            usa: 'ğŸ‡ºğŸ‡¸ Nouvel An AmÃ©ricain',
            mexico: 'ğŸ‡²ğŸ‡½ Nouvel An Mexicain'
        },
        heroSubtitle: 'CrÃ©ez et envoyez des cartes personnalisÃ©es',
        orionPoweredBy: 'ğŸ¤– PropulsÃ© par ORION',

        // Form
        createCardTitle: 'ğŸ† CrÃ©ez votre Carte de Nouvel An IA',
        aiEngine: 'ğŸ¤– Moteur IA',
        recipientName: 'ğŸ‘¤ Nom du destinataire',
        recipientPlaceholder: 'Ex: Marie, Jean Charles, Maman...',
        senderLabel: 'âœï¸ Votre nom (expÃ©diteur)',
        senderPlaceholder: 'Ex: Ta famille, Alex, Avec amour...',
        messageType: 'ğŸ­ Type de message',
        forWhom: 'ğŸ‘« Pour qui est-ce?',
        additionalContext: 'ğŸ’­ Contexte supplÃ©mentaire (optionnel)',
        contextPlaceholder: 'Ex: C\'est ma grand-mÃ¨re de 80 ans qui vit Ã  MedellÃ­n...',
        contextHint: 'L\'IA utilisera cela pour rendre le message plus personnel',

        // Message types
        messageTypes: {
            familiar: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Familial - Chaleureux et Ã©mouvant',
            comico: 'ğŸ˜‚ Comique - DrÃ´le et joyeux',
            amoroso: 'â¤ï¸ Amoureux - Romantique et spÃ©cial',
            motivacional: 'ğŸ’ª Motivationnel - Inspirant et fort',
            espiritual: 'ğŸ™ Spirituel - Foi et bÃ©nÃ©dictions'
        },

        // Gender options
        genderOptions: {
            general: 'ğŸ„ GÃ©nÃ©ral - Pour tout le monde',
            mujer: 'ğŸ‘© Pour elle',
            hombre: 'ğŸ‘¨ Pour lui'
        },

        // AI options
        generateAIMessage: 'âœ¨ GÃ©nÃ©rer un message unique avec IA',
        generateAIImage: 'ğŸ¨ GÃ©nÃ©rer une image de Nouvel An avec IA (DALL-E)',
        attachFile: 'ğŸ“ Joindre un fichier (optionnel)',
        attachHint: 'Image ou vidÃ©o Ã  inclure dans la carte',

        // Image gallery
        selectBackground: 'ğŸ–¼ï¸ Image de fond',

        // TTS
        voiceLabel: 'ğŸ¤ Voix pour lire le message',
        voiceOptions: {
            alegre: 'ğŸ‰ Joyeuse et Festive',
            solemne: 'ğŸ•¯ï¸ Solennelle et Spirituelle',
            comico: 'ğŸ˜‚ Comique et Amusante',
            romantico: 'â¤ï¸ Romantique et Douce',
            motivacional: 'ğŸ’ª Motivationnelle et Ã‰nergique'
        },
        testVoice: 'ğŸ”Š Tester la Voix',

        // Buttons
        createCard: 'ğŸ CrÃ©er une Carte avec IA',
        shareWhatsApp: 'ğŸ“± WhatsApp',
        shareTelegram: 'âœˆï¸ Telegram',
        shareEmail: 'ğŸ“§ Email',
        copyLink: 'ğŸ“‹ Copier le Lien',

        // Card viewer
        openEnvelope: 'âœ‰ï¸ Cliquez pour ouvrir',
        loadingCard: 'Chargement de votre carte...',
        preparingSomething: 'PrÃ©paration de quelque chose de spÃ©cial pour vous âœ¨',
        cardNotFound: 'ğŸ˜¢ Carte non trouvÃ©e',
        linkExpired: 'Le lien peut avoir expirÃ© ou Ãªtre incorrect.',
        createOwn: 'CrÃ©er ma propre carte',
        withLoveFrom: 'Avec amour',

        // Toasts
        imageSelected: 'ğŸ–¼ï¸ Image sÃ©lectionnÃ©e',
        musicPlaying: 'ğŸµ Musique du Nouvel An active',
        musicPaused: 'ğŸ”‡ Musique en pause',
        linkCopied: 'Lien copiÃ©! ğŸ“‹',
        blessingsMsg: 'que cette Nouvelle AnnÃ©e remplisse votre vie de bÃ©nÃ©dictions',
        dear: 'Cher/ChÃ¨re',
        friend: 'Ami/e',
        personalize: 'ğŸ Personnaliser',

        // Footer
        madeWithLove: 'Fait avec â¤ï¸ et esprit festif ğŸ†',

        // Language switch
        switchTo: 'FranÃ§ais'
    }
};

// ============================================
// LANGUAGE MANAGER CLASS
// ============================================
class LanguageManager {
    constructor() {
        this.currentLang = localStorage.getItem('christmas_lang') || 'es';
        this.translations = TRANSLATIONS;
    }

    get(key) {
        const keys = key.split('.');
        let value = this.translations[this.currentLang];
        for (const k of keys) {
            if (value && value[k] !== undefined) {
                value = value[k];
            } else {
                // Fallback to Spanish
                value = this.translations.es;
                for (const k2 of keys) {
                    value = value?.[k2];
                }
                break;
            }
        }
        return value || key;
    }

    setLanguage(lang) {
        if (this.translations[lang]) {
            this.currentLang = lang;
            localStorage.setItem('christmas_lang', lang);
            this.updatePage();
            return true;
        }
        return false;
    }

    toggleLanguage() {
        const nextLang = {
            'es': 'en',
            'en': 'pt',
            'pt': 'fr',
            'fr': 'es'
        };
        const newLang = nextLang[this.currentLang] || 'es';
        this.setLanguage(newLang);
    }

    getCurrentLang() {
        return this.currentLang;
    }

    updatePage() {
        // Update all elements with data-i18n attribute
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            const translation = this.get(key);
            if (translation && typeof translation !== 'object') {
                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                    el.placeholder = translation;
                } else {
                    el.textContent = translation;
                }
            }
        });

        // Update select options
        document.querySelectorAll('[data-i18n-options]').forEach(select => {
            const optionsKey = select.getAttribute('data-i18n-options');
            const options = this.get(optionsKey);
            if (options && typeof options === 'object') {
                Array.from(select.options).forEach(opt => {
                    if (options[opt.value]) {
                        opt.textContent = options[opt.value];
                    }
                });
            }
        });

        // Update language toggle button
        const langBtn = document.getElementById('langToggle');
        if (langBtn) {
            const labels = {
                'es': 'ğŸ‡ºğŸ‡¸ EN',
                'en': 'ğŸ‡µğŸ‡¹ PT',
                'pt': 'ğŸ‡«ğŸ‡· FR',
                'fr': 'ğŸ‡ªğŸ‡¸ ES'
            };
            const nextLang = {
                'es': 'en',
                'en': 'pt',
                'pt': 'fr',
                'fr': 'es'
            };
            langBtn.textContent = labels[this.currentLang] || 'ğŸ‡ºğŸ‡¸ EN';
            // Store next lang for click handler to use indirectly or we rely on toggleLanguage logic
        }

        // Dispatch event for other scripts
        window.dispatchEvent(new CustomEvent('languageChanged', { detail: { lang: this.currentLang } }));
    }

    // Render language toggle button
    renderToggle(containerId = null) {
        const btn = document.createElement('button');
        btn.id = 'langToggle';
        btn.className = 'lang-toggle';
        btn.textContent = 'ğŸŒ'; // Initial placeholder, updated by updatePage
        btn.title = this.get('switchTo');
        btn.onclick = () => this.toggleLanguage();
        btn.style.cssText = `
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 15px;
            background: rgba(0,0,0,0.8);
            color: #FFD700;
            border: 2px solid #FFD700;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            z-index: 10000;
            transition: all 0.3s ease;
        `;

        if (containerId) {
            const container = document.getElementById(containerId);
            if (container) container.appendChild(btn);
        } else {
            document.body.appendChild(btn);
        }
    }
}

// Create global instance
window.langManager = new LanguageManager();

// Auto-render toggle on DOM ready
document.addEventListener('DOMContentLoaded', () => {
    window.langManager.renderToggle();
    window.langManager.updatePage();
});

console.log('ğŸŒ Language Manager loaded. Current: ' + window.langManager.getCurrentLang());
